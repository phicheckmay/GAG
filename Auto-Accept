--[[ üîπ CONFIG + LOADER üîπ ]]
script_key = "bnjmfeqqvbjlaSqVGVDNZshhjuSonYhN";
setfpscap(20)

getgenv().pvbConfig = {
    LOW_CPU = false,
    AUTO_COLLECT_GIFT = true,
    AUTO_SELL_RARITY = {"Rare", "Epic", "Legendary"},
}

task.spawn(function()
    pcall(function()
        loadstring(game:HttpGet("https://api.luarmor.net/files/v3/loaders/9d39e9a9887113322badcaff06f0b034.lua"))()
    end)
end)

--[[ üîπ UI ƒê·∫æM PET (TO G·∫§P 2 + G·ªòP THEO T√äN) üîπ ]]
local Players = game:GetService("Players")
local UIS     = game:GetService("UserInputService")

local LP = Players.LocalPlayer
repeat task.wait() until LP

local PG = LP:FindFirstChildOfClass("PlayerGui")
if not PG then
    warn("[PetCounter] PlayerGui not found -> using CoreGui fallback.")
    PG = game:GetService("CoreGui")
end

-- UI th√¥ng s·ªë
local PANEL_WIDTH, PANEL_HEIGHT = 600, 400     -- ‚úÖ to g·∫•p 2 l·∫ßn
local ROW_HEIGHT = 36                         -- ‚úÖ cao d√≤ng h∆°n
local TITLE = "Pet Counter"
local BACKPACK = LP:WaitForChild("Backpack")

-- ‚úÖ H√†m b·ªè ph·∫ßn tr·ªçng l∆∞·ª£ng, v√≠ d·ª• "Chinchilla [1.23KG]" -> "Chinchilla"
local function baseName(s)
    s = tostring(s or "")

    -- Xo√° ph·∫ßn tr·ªçng l∆∞·ª£ng [1.23KG] ho·∫∑c [xKG]
    s = s:gsub("%s*%[.-KG%]", "")

    -- Xo√° to√†n b·ªô ph·∫ßn trong ngo·∫∑c vu√¥ng c√≤n l·∫°i (v√≠ d·ª• [Epic], [Rare], [x5])
    s = s:gsub("%[.-%]", "")

    -- Xo√° k√Ω t·ª± ƒëi·ªÅu khi·ªÉn, kho·∫£ng tr·∫Øng ·∫©n (zero width, tab, newline, v.v.)
    s = s:gsub("[%z\1-\31\127]", ""):gsub("[\u{200B}-\u{200D}\u{FEFF}]", "")

    -- Xo√° to√†n b·ªô kho·∫£ng tr·∫Øng th·ª´a ƒë·∫ßu/cu·ªëi v√† kho·∫£ng tr·∫Øng k√©p gi·ªØa
    s = s:gsub("^%s+", ""):gsub("%s+$", ""):gsub("%s%s+", " ")

    -- Chu·∫©n ho√° ch·ªØ hoa/th∆∞·ªùng: ch·ªâ vi·∫øt hoa ch·ªØ c√°i ƒë·∫ßu ti√™n
    s = s:lower():gsub("^%l", string.upper)

    return s
end


local function countFromSources(sources)
    local counts = {}
    local function add(inst)
        local n = baseName(inst.Name)
        counts[n] = (counts[n] or 0) + 1
    end
    for _,src in ipairs(sources) do
        if src and src.Parent then
            for _,it in ipairs(src:GetChildren()) do
                if it:IsA("Tool") or it:IsA("Model") or it:IsA("Folder") or it:IsA("Accessory") then
                    add(it)
                end
            end
        end
    end
    return counts
end

-- UI panel
local Screen = Instance.new("ScreenGui")
Screen.Name = "PetCounterUI"
Screen.ResetOnSpawn = false
Screen.IgnoreGuiInset = true
Screen.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
Screen.Parent = PG

local Frame = Instance.new("Frame")
Frame.Name = "Panel"
Frame.Size = UDim2.fromOffset(PANEL_WIDTH, PANEL_HEIGHT)
Frame.AnchorPoint = Vector2.new(0.5, 0.5)
Frame.Position = UDim2.new(0.5, 0, 0.5, 60)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Frame.BackgroundTransparency = 0.15
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Parent = Screen
Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 14)

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "Title"
TitleLabel.Size = UDim2.new(1, -20, 0, 38)
TitleLabel.Position = UDim2.fromOffset(10, 8)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextSize = 26
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
TitleLabel.Text = string.format("%s - %s", TITLE, LP.DisplayName or LP.Name)
TitleLabel.Parent = Frame

-- Danh s√°ch pet
local List = Instance.new("ScrollingFrame")
List.Name = "List"
List.Size = UDim2.new(1, -20, 1, -60)
List.Position = UDim2.fromOffset(10, 48)
List.BackgroundTransparency = 1
List.ScrollBarThickness = 8
List.AutomaticCanvasSize = Enum.AutomaticSize.Y
List.Parent = Frame
local Layout = Instance.new("UIListLayout", List)
Layout.Padding = UDim.new(0, 6)
Layout.SortOrder = Enum.SortOrder.LayoutOrder

local function makeRow(text)
    local tl = Instance.new("TextLabel")
    tl.Size = UDim2.new(1, 0, 0, ROW_HEIGHT)
    tl.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    tl.BackgroundTransparency = 0.25
    tl.BorderSizePixel = 0
    tl.Font = Enum.Font.GothamBold
    tl.TextSize = 22
    tl.TextColor3 = Color3.fromRGB(255, 100, 100)
    tl.TextXAlignment = Enum.TextXAlignment.Left
    tl.Text = text
    Instance.new("UICorner", tl).CornerRadius = UDim.new(0, 10)
    local pad = Instance.new("UIPadding", tl)
    pad.PaddingLeft = UDim.new(0, 10)
    return tl
end

-- L√†m m·ªõi danh s√°ch
local function refresh()
    local character = LP.Character or LP.CharacterAdded:Wait()
    local counts = countFromSources({BACKPACK, character})

    for _,ch in ipairs(List:GetChildren()) do
        if ch:IsA("TextLabel") then ch:Destroy() end
    end

    local arr = {}
    local total = 0
    for name,cnt in pairs(counts) do
        total += cnt
        table.insert(arr, {name=name, cnt=cnt})
    end
    table.sort(arr, function(a,b) return a.cnt==b.cnt and a.name<b.name or a.cnt>b.cnt end)

    TitleLabel.Text = string.format("%s - %s (%d pets)", TITLE, LP.DisplayName or LP.Name, total)

    for _,it in ipairs(arr) do
        makeRow(("%s  √ó %d"):format(it.name, it.cnt)).Parent = List
    end
end
refresh()

-- Theo d√µi thay ƒë·ªïi
local function wireFolder(folder)
    folder.ChildAdded:Connect(refresh)
    folder.ChildRemoved:Connect(refresh)
    for _,ch in ipairs(folder:GetChildren()) do
        if ch.GetPropertyChangedSignal then
            ch:GetPropertyChangedSignal("Name"):Connect(refresh)
        end
    end
end

wireFolder(BACKPACK)
LP.CharacterAdded:Connect(function(char)
    refresh()
    wireFolder(char)
end)
if LP.Character then wireFolder(LP.Character) end

-- ·∫®n/hi·ªán UI b·∫±ng ph√≠m K
UIS.InputBegan:Connect(function(i,gp)
    if not gp and i.KeyCode == Enum.KeyCode.K then
        Screen.Enabled = not Screen.Enabled
    end
end)
