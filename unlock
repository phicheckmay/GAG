--====================================================
-- ‚öôÔ∏è CONFIG ‚Äî ch·ªâ c·∫ßn ch·ªânh trong ph·∫ßn n√†y
--====================================================
local CONFIG = {
    WAIT_BEFORE_START = 3,    -- ƒë·ª£i 3s cho game load xong
    SELL_INTERVAL = 120,      -- 120s/l·∫ßn b√°n to√†n b·ªô
    BUY_INTERVAL  = 10,       -- 10s/l·∫ßn mua h·∫°t
    ENABLE_UNFAVORITE = true, -- B·ªè tim t·∫•t c·∫£ pet ‚ù§Ô∏è
    ENABLE_AUTOSELL   = true, -- Set autosell
    ENABLE_SELL_LOOP  = true, -- L·∫∑p Sell All
    ENABLE_BUY_SEED   = true, -- Mua h·∫°t

    SEED_SELLER = "George",   -- NPC b√°n h·∫°t
    SEED_LIST = { "Shroombino", "Mango", "King Limone", "Starfruit" },

    AUTOSELL_CONFIG = {       -- true = x√°m = b√°n, false = m√†u = gi·ªØ
        Normal     = true,
        Rare       = true,
        Epic       = true,
        Legendary  = true,
        Mythic     = true,
        Secret     = true,
        Godly      = true,
        Limited    = true,
        Diamond    = true,
        Neon       = true,
        CandyCorn  = true,
        Rainbow    = true,
        Magma      = true,
        Headless   = true,
        Ruby       = true,
    }
}

--====================================================
-- üöÄ SYSTEM START
--====================================================
repeat task.wait() until game:IsLoaded()
task.wait(CONFIG.WAIT_BEFORE_START)

local RS = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LP = Players.LocalPlayer
local Remotes = RS:FindFirstChild("Remotes") or RS

local FavoriteItem = Remotes:FindFirstChild("FavoriteItem", true)
local AutoSellRemote = Remotes:FindFirstChild("AutoSell", true)
local SellRemote = Remotes:WaitForChild("ItemSell")
local RequestAsset = Remotes:FindFirstChild("SelectiveAssetService", true)
	and Remotes.SelectiveAssetService:FindFirstChild("RequestAsset")
local BuyItem = Remotes:FindFirstChild("BuyItem", true)

--====================================================
-- ü©∑ B1: B·ªé TIM TO√ÄN B·ªò PET
--====================================================
local function UnfavoriteAll()
	if not CONFIG.ENABLE_UNFAVORITE then return end
	print("üîì ƒêang b·ªè tim t·∫•t c·∫£ pet...")
	if not FavoriteItem then return warn("‚ùå Kh√¥ng c√≥ Remote FavoriteItem") end

	local FavoritesTable
	for _, v in ipairs(getgc(true)) do
		if typeof(v) == "table" and rawget(v, "Favorites") then
			FavoritesTable = rawget(v, "Favorites")
			break
		end
	end
	if not FavoritesTable then return warn("‚ùå Kh√¥ng t√¨m th·∫•y b·∫£ng Favorites") end

	local count = 0
	for uuid in pairs(FavoritesTable) do
		if typeof(uuid) == "string" and uuid:match("%x+%-%x+%-%x+%-%x+%-%x+") then
			FavoriteItem:FireServer(uuid)
			count += 1
			task.wait(0.05)
		end
	end
	print(("‚úÖ ƒê√£ b·ªè tim %d pet c√≥ ‚ù§Ô∏è"):format(count))
end

--====================================================
-- ‚öôÔ∏è B2: SET AUTOSELL
--====================================================
local function LocateAutoSellTable()
	for _, v in ipairs(getgc(true)) do
		if typeof(v) == "table" and rawget(v, "AutoSell") then
			return v.AutoSell
		end
	end
end

local function isOn(tbl, rarity)
	local v = tbl and tbl[rarity]
	return v == 1 or v == true
end

local function toggleUntil(remote, tbl, rarity, targetOn, maxTries, delayStep)
	maxTries = maxTries or 3
	delayStep = delayStep or 0.15
	for i = 1, maxTries do
		if isOn(tbl, rarity) == targetOn then
			return true, ("‚úÖ %s ƒë√£ ƒë√∫ng (%s)"):format(rarity, targetOn and "GRAY" or "COLOR")
		end
		if remote then remote:FireServer(rarity) end
		local t0 = tick()
		repeat
			task.wait(delayStep)
			if isOn(tbl, rarity) == targetOn then
				return true, ("‚öôÔ∏è %s ‚Üí %s (sau %d l·∫ßn)"):format(rarity, targetOn and "GRAY" or "COLOR", i)
			end
		until tick() - t0 > 2
	end
	return false, ("‚ùå %s kh√¥ng h·ªôi t·ª• v·ªÅ %s"):format(rarity, targetOn and "GRAY" or "COLOR")
end

local function ApplyAutoSellConfig()
	if not CONFIG.ENABLE_AUTOSELL then return end
	local tbl = LocateAutoSellTable()
	if not (tbl and AutoSellRemote) then return warn("‚ùå Kh√¥ng t√¨m th·∫•y AutoSell table/remote") end
	print("‚öôÔ∏è C·∫•u h√¨nh AutoSell...")
	for rarity, wantGray in pairs(CONFIG.AUTOSELL_CONFIG) do
		local ok, msg = toggleUntil(AutoSellRemote, tbl, rarity, wantGray, 3, 0.1)
		print(msg)
		task.wait(0.05)
	end
	print("üéØ AUTOSELL ho√†n t·∫•t.")
end

--====================================================
-- üí∞ B3: AUTO SELL ALL (chu·∫©n ch·ªØ k√Ω)
--====================================================
local function SellAllLoop()
	if not CONFIG.ENABLE_SELL_LOOP then return end
	task.spawn(function()
		while true do
			SellRemote:FireServer(nil, nil, true) -- üóë b√°n t·∫•t c·∫£ Brainrots
			print("‚úÖ SELL ALL Brainrots DONE!")
			task.wait(CONFIG.SELL_INTERVAL)
		end
	end)
end

--====================================================
-- üåæ B4: AUTO BUY SEED
--====================================================
local function AutoBuySeedLoop()
	if not CONFIG.ENABLE_BUY_SEED then return end
	if not (RequestAsset and BuyItem) then return warn("‚ùå Kh√¥ng c√≥ Remote mua h·∫°t") end
	local seller = CONFIG.SEED_SELLER
	local list = CONFIG.SEED_LIST

	task.spawn(function()
		while true do
			RequestAsset:FireServer("Brainrots", seller)
			task.wait(1)
			for _, seed in ipairs(list) do
				pcall(function()
					BuyItem:FireServer(seed, true)
					print("üå± ƒê√£ mua:", seed)
				end)
				task.wait(0.3)
			end
			task.wait(CONFIG.BUY_INTERVAL)
		end
	end)
end

--====================================================
-- üöÄ RUN SEQUENCE
--====================================================
UnfavoriteAll()
task.wait(1)
ApplyAutoSellConfig()
SellAllLoop()
AutoBuySeedLoop()
print("‚úÖ H·ªá th·ªëng t·ª± ƒë·ªông (Unlock + AutoSell + SellAll + BuySeed) ƒë√£ kh·ªüi ch·∫°y!")
