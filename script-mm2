if not game:IsLoaded() then
    game.Loaded:Wait()
end


local MYSTERY_BOX_PRICE = 800

local WEAPONS = {
    {id = "Snowcannon", displayName = "Snowcannon"},
    {id = "SnowcannonChroma", displayName = "Snowcannon (Chroma)"},
    {id = "SnowDagger", displayName = "Snow Dagger"},
    {id = "SnowDaggerChroma", displayName = "Snow Dagger (Chroma)"}
}

local Player = game.Players.LocalPlayer
local Players = game.Players
local Character = Player.Character or Player.CharacterAdded:Wait()
local BadanPart = Character:WaitForChild("HumanoidRootPart")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")

local CoinCollectedEvent = game.ReplicatedStorage.Remotes.Gameplay.CoinCollected
local RoundStartEvent = game.ReplicatedStorage.Remotes.Gameplay.RoundStart
local RoundEndEvent = game.ReplicatedStorage.Remotes.Gameplay.RoundEndFade
local AutofarmStarted = false
local RoundEnded = false
local ResetWhenFullBag = true 
local CurrentCoinType = "SnowTokens2025"
local BagFull = false

local christmasTokenCounterGui = nil
local christmasTokenGreenScreenGui = nil
local christmasTokenToggleButtonGui = nil
local christmasTokenDetectorThread = nil
local isGreenScreenEnabled = true
local christmasTokenDetectorInitialized = false
local christmasTokenTarget = 110000

local screenGui = nil
local toggleGui = nil
local isEnabled = true
local initialized = false

task.spawn(function()
    task.wait(10)
    while true do
        pcall(function()
            for _, v in pairs(game.Players.LocalPlayer.Character:GetDescendants()) do
                if v:IsA("BasePart") and v.CanCollide == true then
                    v.CanCollide = false
                end
            end
        end)
        game:GetService("RunService").Stepped:Wait()
    end
end)

task.spawn(function()
    task.wait(2)
    local maxWaitTime = 30
    local startTime = tick()
    local clicked = false
    
    while tick() - startTime < maxWaitTime and not clicked do
        pcall(function()
            local playerGui = game.Players.LocalPlayer:FindFirstChild("PlayerGui")
            if playerGui then
                local deviceSelect = playerGui:FindFirstChild("DeviceSelect")
                if deviceSelect then
                    local container = deviceSelect:FindFirstChild("Container")
                    if container then
                        local tablet = container:FindFirstChild("Tablet")
                        if tablet then
                            local button = tablet:FindFirstChild("Button")
                            if button then
                                firesignal(button.MouseButton1Click)
                                clicked = true
                            end
                        end
                    end
                end
            end
        end)
        
        if not clicked then
            task.wait(0.5)
        end
    end
end)

task.spawn(function()
    task.wait(60)
    local function AntiAFK()
        local GC = getconnections or get_signal_cons
        if GC then
            for _, v in pairs(GC(Player.Idled)) do
                if v["Disable"] then
                    v["Disable"](v)
                elseif v["Disconnect"] then
                    v["Disconnect"](v)
                end
            end
        else
            local VirtualUser = cloneref(game:GetService("VirtualUser"))
            Players.LocalPlayer.Idled:Connect(function()
                VirtualUser:CaptureController()
                VirtualUser:ClickButton2(Vector2.new())
            end)
        end
    end
    AntiAFK()
end)

coroutine.wrap(function()
    task.wait(60)
    local function setupGUIToggle()
        local guiObjects = {}
        
        local success = pcall(function()
            for _, gui in pairs(gethui():GetChildren()) do
                if gui:IsA("ScreenGui") then
                    if gui.Name == "ChristmasTokenCounter" or gui.Name == "ChristmasTokenGreenScreen" or 
                       gui.Name == "GreenScreen" or gui.Name == "ChristmasTokenToggleButton" or 
                       gui.Name == "BeachBallCounter" or gui.Name == "WeaponChecker" or gui.Name == "WeaponToggle" then
                        continue
                    end
                    
                    for _, obj in pairs(gui:GetDescendants()) do
                        if obj:IsA("GuiObject") and obj.Visible ~= nil then
                            obj.Visible = false
                            table.insert(guiObjects, obj)
                        end
                    end
                end
            end
        end)
        
        if not success then
            return
        end
        
        local btnGui = Instance.new("ScreenGui")
        btnGui.Name = "ToggleGuiButton"
        btnGui.ResetOnSpawn = false
        btnGui.IgnoreGuiInset = true
        btnGui.Parent = gethui()
        
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0, 100, 0, 30)
        btn.Position = UDim2.new(1, -110, 1, -40)
        btn.Text = "Show GUIs"
        btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        btn.TextColor3 = Color3.new(1, 1, 1)
        btn.TextStrokeTransparency = 0
        btn.TextStrokeColor3 = Color3.new(0, 0, 0)
        btn.BorderSizePixel = 0
        btn.Font = Enum.Font.SourceSansBold
        btn.TextSize = 12
        btn.Parent = btnGui
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 5)
        corner.Parent = btn
        
        local visible = false
        btn.MouseButton1Click:Connect(function()
            visible = not visible
            
            if visible then
                btn.Text = "Hide GUIs"
                btn.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
            else
                btn.Text = "Show GUIs"
                btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
            end
            
            local toggledCount = 0
            for _, obj in ipairs(guiObjects) do
                if obj and obj:IsA("GuiObject") and obj.Parent then
                    obj.Visible = visible
                    toggledCount = toggledCount + 1
                end
            end
        end)
    end
    setupGUIToggle()
end)()

local function getSnowTokens()
    local snowTokens = 0
    pcall(function()
        local ProfileData = require(game:GetService("ReplicatedStorage"):WaitForChild("Modules"):WaitForChild("ProfileData"))
        if ProfileData and ProfileData.Materials and ProfileData.Materials.Owned then
            snowTokens = tonumber(ProfileData.Materials.Owned["SnowTokens2025"]) or 0
        end
    end)
    return snowTokens
end

local function getSnowKeys()
    local snowKeys = 0
    pcall(function()
        local ProfileData = require(game:GetService("ReplicatedStorage"):WaitForChild("Modules"):WaitForChild("ProfileData"))
        if ProfileData and ProfileData.Materials and ProfileData.Materials.Owned then
            snowKeys = tonumber(ProfileData.Materials.Owned["SnowKey2025"]) or 0
        end
    end)
    return snowKeys
end

local function getChristmasTokens()
    return getSnowTokens()
end

local function formatNumber(num)
    local formatted = tostring(num)
    local k
    while true do
        formatted, k = string.gsub(formatted, "^(-?%d+)(%d%d%d)", '%1,%2')
        if k == 0 then break end
    end
    return formatted
end

local function CreateFiles(FileName, File)
    pcall(function()
        makefolder("ServerHopper")
        makefolder("ServerHopper//" .. game.PlaceId)
        writefile("ServerHopper//" .. game.PlaceId .. "//" .. FileName .. ".json", File)
    end)
end

local function hopToLowPlayers(Logs, Amount, MinPlayers, MaxPlayers)
    if Players == nil then
        Players = 3
    end

    if Amount == nil then
        Amount = tonumber(math.huge)
    end
    
    local JobIDs = {}
    local API, ServerPages
    
    local function FetchJobIDs()
        JobIDs = {os.date("*t").hour}
        local _s = tick()
        
        repeat
            task.wait(2)
            local success, result = pcall(function()
                API = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100" .. (ServerPages and "&cursor=" .. ServerPages or "")))
            end)

            if not success then
                task.wait(10)
                return false
            end

            for i, v in next, API["data"] do
                if v["id"] ~= game.JobId and v["playing"] ~= v["maxPlayers"] and v["playing"] >= MinPlayers and v["playing"] <= MaxPlayers then
                    if #JobIDs < Amount + 1 then
                        table.insert(JobIDs, v["id"])
                    end
                end
            end
            ServerPages = API.nextPageCursor
        until not ServerPages or #JobIDs >= Amount + 1
        
        return true
    end
    
    if not isfile("ServerHopper//" .. game.PlaceId .. "//low_players-jobids.json") then
        FetchJobIDs()
        CreateFiles("low_players-jobids", HttpService:JSONEncode(JobIDs))
    end
    
    JobIDs = HttpService:JSONDecode(readfile("ServerHopper//" .. game.PlaceId .. "//low_players-jobids.json"))
    
    if JobIDs[1] ~= os.date("*t").hour then
        FetchJobIDs()
        writefile("ServerHopper//" .. game.PlaceId .. "//low_players-jobids.json", HttpService:JSONEncode(JobIDs))
    end
    
    local function RandomJobID()
        return JobIDs[math.random(1, #JobIDs)]
    end
    
    local SelectedJobID = RandomJobID()
    
    TeleportService:TeleportToPlaceInstance(game.PlaceId, SelectedJobID)
    
    game.Players.LocalPlayer.OnTeleport:Connect(function(Status)
        if Status == Enum.TeleportState.Failed then
            SelectedJobID = RandomJobID()
            TeleportService:TeleportToPlaceInstance(game.PlaceId, SelectedJobID)
        end
    end)
end

local roundTimeout = 10 * 60
local lastRoundStartTime = tick()
local isRoundActive = false

local function checkRoundTimeout()
    local currentTime = tick()
    local timeSinceLastRound = currentTime - lastRoundStartTime
    
    if timeSinceLastRound >= roundTimeout and not isRoundActive then
        hopToLowPlayers(false, 50, 4, 10)
    end
end

local function setupChristmasTokenTracker()
    if christmasTokenDetectorInitialized then return end
    christmasTokenDetectorInitialized = true
    
    christmasTokenCounterGui = Instance.new("ScreenGui")
    christmasTokenCounterGui.Name = "ChristmasTokenCounter"
    christmasTokenCounterGui.ResetOnSpawn = false
    christmasTokenCounterGui.IgnoreGuiInset = true
    christmasTokenCounterGui.DisplayOrder = 999
    christmasTokenCounterGui.Enabled = true
    
    local counterText = Instance.new("TextLabel")
    counterText.Size = UDim2.new(0, 800, 0, 150)
    counterText.Position = UDim2.new(0.5, -400, 0.5, -75)
    counterText.BackgroundTransparency = 0
    counterText.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    counterText.BorderSizePixel = 0
    counterText.Font = Enum.Font.SourceSansBold
    counterText.TextSize = 50
    counterText.TextColor3 = Color3.fromRGB(255, 255, 255)
    counterText.Text = string.format("â„ï¸ %s", formatNumber(getChristmasTokens()))
    counterText.TextStrokeTransparency = 0
    counterText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    counterText.Name = "CounterText"
    counterText.Parent = christmasTokenCounterGui
    
    christmasTokenCounterGui.Parent = gethui()
    
    christmasTokenGreenScreenGui = Instance.new("ScreenGui")
    christmasTokenGreenScreenGui.Name = "ChristmasTokenGreenScreen"
    christmasTokenGreenScreenGui.ResetOnSpawn = false
    christmasTokenGreenScreenGui.IgnoreGuiInset = true
    christmasTokenGreenScreenGui.DisplayOrder = 1000
    christmasTokenGreenScreenGui.Enabled = false
    
    local greenFrame = Instance.new("Frame")
    greenFrame.Size = UDim2.new(1, 0, 1, 0)
    greenFrame.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
    greenFrame.BorderSizePixel = 0
    greenFrame.Name = "GreenScreen"
    greenFrame.Parent = christmasTokenGreenScreenGui
    
    local achievementText = Instance.new("TextLabel")
    achievementText.Size = UDim2.new(0.8, 0, 0.6, 0)
    achievementText.Position = UDim2.new(0.1, 0, 0.2, 0)
    achievementText.BackgroundTransparency = 1
    achievementText.Font = Enum.Font.SourceSansBold
    achievementText.TextSize = 80
    achievementText.TextWrapped = true
    achievementText.TextColor3 = Color3.fromRGB(255, 255, 255)
    achievementText.Text = "ðŸŽ‰ TARGET ACHIEVED! ðŸŽ‰"
    achievementText.TextStrokeTransparency = 0
    achievementText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    achievementText.Name = "AchievementText"
    achievementText.Parent = greenFrame
    
    local copyButton = Instance.new("TextButton")
    copyButton.Size = UDim2.new(0, 200, 0, 50)
    copyButton.Position = UDim2.new(0.5, -100, 0.85, 0)
    copyButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    copyButton.BorderSizePixel = 2
    copyButton.BorderColor3 = Color3.fromRGB(255, 255, 255)
    copyButton.Font = Enum.Font.SourceSansBold
    copyButton.TextSize = 25
    copyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    copyButton.Text = "Copy Job ID"
    copyButton.Parent = greenFrame
    
    copyButton.MouseButton1Click:Connect(function()
        setclipboard(game.JobId)
        copyButton.Text = "Copied!"
        copyButton.BackgroundColor3 = Color3.fromRGB(0, 120, 0)
        task.wait(1)
        copyButton.Text = "Copy Job ID"
        copyButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    end)
    
    christmasTokenGreenScreenGui.Parent = gethui()
    
    christmasTokenToggleButtonGui = Instance.new("ScreenGui")
    christmasTokenToggleButtonGui.Name = "ChristmasTokenToggleButton"
    christmasTokenToggleButtonGui.ResetOnSpawn = false
    christmasTokenToggleButtonGui.IgnoreGuiInset = true
    christmasTokenToggleButtonGui.DisplayOrder = 1001
    christmasTokenToggleButtonGui.Enabled = false
    
    local toggleButton = Instance.new("TextButton")
    toggleButton.Size = UDim2.new(0, 150, 0, 40)
    toggleButton.Position = UDim2.new(0.5, -75, 0, 10)
    toggleButton.BackgroundColor3 = Color3.fromRGB(0, 191, 255)
    toggleButton.BorderSizePixel = 2
    toggleButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
    toggleButton.Font = Enum.Font.SourceSansBold
    toggleButton.TextSize = 16
    toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggleButton.Text = "â„ï¸ HIDE GREEN"
    toggleButton.Name = "ChristmasTokenToggle"
    toggleButton.Parent = christmasTokenToggleButtonGui
    
    toggleButton.MouseButton1Click:Connect(function()
        isGreenScreenEnabled = not isGreenScreenEnabled
        christmasTokenGreenScreenGui.Enabled = isGreenScreenEnabled
        toggleButton.Text = isGreenScreenEnabled and "â„ï¸ HIDE GREEN" or "â„ï¸ SHOW GREEN"
    end)
    
    christmasTokenToggleButtonGui.Parent = gethui()
    
    christmasTokenDetectorThread = task.spawn(function()
        while true do
            pcall(function()
                local currentTokens = getChristmasTokens()
                
                if christmasTokenCounterGui and christmasTokenCounterGui.CounterText then
                    local newText = string.format("â„ï¸ %s", formatNumber(currentTokens))
                    christmasTokenCounterGui.CounterText.Text = newText
                end
                
                if currentTokens >= christmasTokenTarget then
                    christmasTokenToggleButtonGui.Enabled = true
                    christmasTokenGreenScreenGui.Enabled = isGreenScreenEnabled
                    
                    if christmasTokenGreenScreenGui.GreenScreen and christmasTokenGreenScreenGui.GreenScreen.AchievementText then
                        local playerName = game.Players.LocalPlayer.Name
                        christmasTokenGreenScreenGui.GreenScreen.AchievementText.Text = string.format(
                            "ðŸŽ‰ %s ðŸŽ‰\n\nTARGET ACHIEVED!\n\nâ„ï¸ %s Snow Tokens\n\nðŸ“± %s",
                            playerName,
                            string.format("%,d", currentTokens),
                            game.JobId:sub(1, 8) .. "..."
                        )
                    end
                else
                    christmasTokenToggleButtonGui.Enabled = false
                    christmasTokenGreenScreenGui.Enabled = false
                end
            end)
            task.wait(1)
        end
    end)
end

setupChristmasTokenTracker()

local function setupWeaponChecker()
    if initialized then return end
    initialized = true
    
    screenGui = Instance.new("ScreenGui")
    screenGui.Name = "WeaponChecker"
    screenGui.ResetOnSpawn = false
    screenGui.IgnoreGuiInset = true
    screenGui.DisplayOrder = 1002
    screenGui.Enabled = false
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
    frame.BorderSizePixel = 0
    frame.Name = "Screen"
    frame.Parent = screenGui
    
    local text = Instance.new("TextLabel")
    text.Size = UDim2.new(0.8, 0, 0.7, 0)
    text.Position = UDim2.new(0.1, 0, 0.15, 0)
    text.BackgroundTransparency = 1
    text.Font = Enum.Font.SourceSansBold
    text.TextSize = 50
    text.TextWrapped = true
    text.TextColor3 = Color3.fromRGB(255, 255, 255)
    text.TextStrokeTransparency = 0
    text.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    text.Name = "Text"
    text.Parent = frame
    
    local copyBtn = Instance.new("TextButton")
    copyBtn.Size = UDim2.new(0.2, 0, 0.08, 0)
    copyBtn.Position = UDim2.new(0.4, 0, 0.85, 0)
    copyBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    copyBtn.BorderSizePixel = 0
    copyBtn.Font = Enum.Font.SourceSansBold
    copyBtn.TextSize = 18
    copyBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    copyBtn.Text = "Copy JobID"
    copyBtn.Parent = frame
    
    copyBtn.MouseButton1Click:Connect(function()
        setclipboard(game.JobId)
        copyBtn.Text = "Copied!"
        task.wait(1)
        copyBtn.Text = "Copy JobID"
    end)
    
    screenGui.Parent = gethui()
    
    toggleGui = Instance.new("ScreenGui")
    toggleGui.Name = "WeaponToggle"
    toggleGui.ResetOnSpawn = false
    toggleGui.IgnoreGuiInset = true
    toggleGui.DisplayOrder = 1003
    toggleGui.Enabled = false
    
    local toggleBtn = Instance.new("TextButton")
    toggleBtn.Size = UDim2.new(0, 120, 0, 35)
    toggleBtn.Position = UDim2.new(0.5, -60, 0, 20)
    toggleBtn.BackgroundColor3 = Color3.fromRGB(255, 165, 0)
    toggleBtn.BorderSizePixel = 0
    toggleBtn.Font = Enum.Font.SourceSansBold
    toggleBtn.TextSize = 14
    toggleBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
    toggleBtn.Text = "ðŸ—¡ï¸ HIDE"
    toggleBtn.Parent = toggleGui
    
    toggleBtn.MouseButton1Click:Connect(function()
        isEnabled = not isEnabled
        screenGui.Enabled = isEnabled
        toggleBtn.Text = isEnabled and "ðŸ—¡ï¸ HIDE" or "ðŸ—¡ï¸ SHOW"
    end)
    
    toggleGui.Parent = gethui()
end

task.spawn(function()
    setupWeaponChecker()
    
    while true do
        pcall(function()
            local ownedWeapons = {}
            local hasChroma = false
            
            local ProfileData = require(game:GetService("ReplicatedStorage"):WaitForChild("Modules"):WaitForChild("ProfileData"))
            if ProfileData and ProfileData.Weapons and ProfileData.Weapons.Owned then
                for _, weapon in pairs(WEAPONS) do
                    local quantity = ProfileData.Weapons.Owned[weapon.id] or 0
                    if quantity > 0 then
                        table.insert(ownedWeapons, {
                            displayName = weapon.displayName,
                            id = weapon.id,
                            quantity = quantity
                        })
                        if string.find(weapon.id, "Chroma") then
                            hasChroma = true
                        end
                    end
                end
            end
            
            if #ownedWeapons > 0 then
                toggleGui.Enabled = true
                
                local color = hasChroma and Color3.fromRGB(128, 0, 128) or Color3.fromRGB(0, 255, 0)
                local title = hasChroma and "ðŸŸ£ CHROMA WEAPONS" or "ðŸŸ¢ WEAPONS OWNED"
                
                screenGui.Screen.BackgroundColor3 = color
                
                local weaponText = ""
                for _, weapon in pairs(ownedWeapons) do
                    local chromaText = string.find(weapon.id, "Chroma") and " (Chroma)" or ""
                    weaponText = weaponText .. weapon.quantity .. "x " .. weapon.displayName .. chromaText .. "\n"
                end
                
                local displayText = string.format(
                    "%s\n\n%s\n\n%s\nðŸ“± %s",
                    game.Players.LocalPlayer.Name,
                    title,
                    weaponText,
                    game.JobId:sub(1, 8) .. "..."
                )
                
                screenGui.Screen.Text.Text = displayText
                screenGui.Enabled = isEnabled
                
                local toggleBtn = toggleGui:FindFirstChild("TextButton")
                if toggleBtn then
                    toggleBtn.Text = isEnabled and "ðŸ—¡ï¸ HIDE" or "ðŸ—¡ï¸ SHOW"
                end
            else
                toggleGui.Enabled = false
                screenGui.Enabled = false
            end
        end)
        task.wait(3)
    end
end)

task.spawn(function()
    while true do
        pcall(function()
            local snowTokens = getSnowTokens()
            
            if snowTokens >= MYSTERY_BOX_PRICE then
                pcall(function()
                    game:GetService("ReplicatedStorage").Remotes.Shop.OpenCrate:InvokeServer("Christmas2025Box", "MysteryBox", "SnowTokens2025")
                end)
                task.wait(2)
            else
                task.wait(10)
            end
        end)
        task.wait(3)
    end
end)

task.spawn(function()
    while true do
        pcall(function()
            local snowKeys = getSnowKeys()
            
            if snowKeys > 0 then
                pcall(function()
                    game:GetService("ReplicatedStorage").Remotes.Shop.OpenCrate:InvokeServer("Christmas2025Box", "MysteryBox", "SnowKey2025")
                end)
                task.wait(2)
            else
                task.wait(10)
            end
        end)
        task.wait(3)
    end
end)

task.spawn(function()
    while true do
        pcall(function()
            if game:GetService("Players").LocalPlayer.PlayerGui.MainGUI.Game.NewItem.Visible == true then
                task.wait(1)
                firesignal(game:GetService("Players").LocalPlayer.PlayerGui.MainGUI.Game.NewItem.Container.Claim.MouseButton1Click)
            end
        end)
        task.wait(1)
    end
end)

local function createPlatform()
    local existingPlatform = workspace:FindFirstChild("Papan")
    if existingPlatform then
        return existingPlatform
    end

    local platform = Instance.new("Part")
    platform.Size = Vector3.new(50, 1, 50)
    platform.Anchored = true
    platform.CanCollide = true
    platform.Material = Enum.Material.SmoothPlastic
    platform.Color = Color3.new(1, 1, 1)
    platform.Name = "Papan"

    local randomX = math.random(-100, -50)
    local randomZ = math.random(-150, -100)
    platform.CFrame = CFrame.new(randomX, -180, randomZ)

    platform.Parent = workspace
    return platform
end

task.spawn(function()
    while true do
        createPlatform()
        task.wait(5)
    end
end)

local function teleportToPlatform()
    local platform = workspace:FindFirstChild("Papan")
    if not platform then
        platform = createPlatform()
    end
    if BadanPart then
        local yOffset = platform.Size.Y / 2 + BadanPart.Size.Y / 2 + 4
        BadanPart.CFrame = platform.CFrame + Vector3.new(0, yOffset, 0)
    end
end

local function tweenWithBodyVelocity(targetCFrame)
    local bodyVelocity = BadanPart:FindFirstChild("BodyVelocity")
    if not bodyVelocity then
        bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
        bodyVelocity.P = 1250
        bodyVelocity.Velocity = Vector3.zero
        bodyVelocity.Parent = BadanPart
    end

    local duration = 0
    local startTime = tick()
    local startCFrame = BadanPart.CFrame
    local elapsedTime = 0

    while elapsedTime < duration do
        elapsedTime = tick() - startTime
        local alpha = elapsedTime / duration
        local currentCFrame = startCFrame:Lerp(targetCFrame, alpha)

        local velocity = (currentCFrame.Position - BadanPart.Position).Unit * 25
        bodyVelocity.Velocity = velocity

        BadanPart.CFrame = currentCFrame
        task.wait(0.01)
    end

    bodyVelocity.Velocity = Vector3.zero
    bodyVelocity:Destroy()

    BadanPart.CFrame = targetCFrame
end

local function returncoincontainer()
    for _, v in workspace:GetChildren() do
        if v:FindFirstChild("CoinContainer") and v:IsA("Model") then
            return v:FindFirstChild("CoinContainer")
        end
    end
    return false
end

local function getRandomCoin(container)
    local coins = container:GetChildren()
    for i = #coins, 2, -1 do
        local j = math.random(1, i)
        coins[i], coins[j] = coins[j], coins[i]
    end

    for _, coin in ipairs(coins) do
        if coin:FindFirstChild("TouchInterest") then
            return coin
        end
    end
    return nil
end

CoinCollectedEvent.OnClientEvent:Connect(function(cointype, current, max)
    AutofarmStarted = true
    
    if tonumber(current) >= tonumber(max) then
        AutofarmStarted = false
        BagFull = true

        if ResetWhenFullBag then
            local isMurderer = false
            pcall(function()
                local CurrentRoundClient = require(game.ReplicatedStorage:WaitForChild("Modules"):WaitForChild("CurrentRoundClient"))
                local playerData = CurrentRoundClient.GetLatestPlayerData()
                
                if playerData and playerData[Player.Name] then
                    local playerRole = playerData[Player.Name].Role
                    if playerRole == "Murderer" then
                        isMurderer = true
                    end
                end
            end)
            
            if not isMurderer then
                pcall(function()
                    if Player.Character and Player.Character:FindFirstChild("Humanoid") then
                        Player.Character.Humanoid.Health = 0
                    end
                end)
            end
        end
    end
end)

RoundStartEvent.OnClientEvent:Connect(function()
    lastRoundStartTime = tick()
    isRoundActive = true
    AutofarmStarted = true
    RoundEnded = false
    BagFull = false
end)

RoundEndEvent.OnClientEvent:Connect(function()
    isRoundActive = false
    AutofarmStarted = false
    RoundEnded = true
end)

task.spawn(function()
    task.wait(30)
    while true do
        checkRoundTimeout()
        task.wait(30)
    end
end)

while true do
    pcall(function()
        if AutofarmStarted and not RoundEnded and not BagFull and 
            (function()
                local success, result = pcall(function()
                    local CurrentRoundClient = require(game.ReplicatedStorage:WaitForChild("Modules"):WaitForChild("CurrentRoundClient"))
                    local playerData = CurrentRoundClient.PlayerData[Player.Name]
                    return playerData and playerData.Dead ~= true
                end)
                return success and result
            end)() then
            local character = Player.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                BadanPart = character.HumanoidRootPart 
                
                local coinContainer = returncoincontainer()
                if coinContainer then
                    local coin = getRandomCoin(coinContainer)
                    if coin then
                        tweenWithBodyVelocity(coin.CFrame)

                        while coin.Parent == coinContainer and coin:FindFirstChild("TouchInterest") do
                            task.wait(0.1)
                            pcall(function()
                                firetouchinterest(BadanPart, coin, 0)
                                task.wait(0.1)
                                firetouchinterest(BadanPart, coin, 1)
                            end)
                        end
                        teleportToPlatform()

                        task.wait(1.7)
                    end
                end
            end
        end
    end)
    task.wait(0.2)
end
